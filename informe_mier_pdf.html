<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Informe Mi Entre R铆os</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }
        
        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }
        
        .content {
            padding: 40px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }
        
        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
            transition: transform 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
        }
        
        .stat-card h3 {
            font-size: 0.9em;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 15px;
            opacity: 0.9;
        }
        
        .stat-card .number {
            font-size: 3em;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .stat-card .label {
            font-size: 0.95em;
            opacity: 0.8;
        }
        
        .section {
            margin-bottom: 50px;
        }
        
        .section h2 {
            color: #667eea;
            font-size: 1.8em;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #667eea;
        }
        
        .chart-container {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .chart-wrapper {
            position: relative;
            height: 400px;
        }
        
        .table-container {
            overflow-x: auto;
            background: #f8f9fa;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 10px;
            overflow: hidden;
        }
        
        thead {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        th, td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }
        
        th {
            font-weight: 600;
            text-transform: uppercase;
            font-size: 0.85em;
            letter-spacing: 0.5px;
        }
        
        tbody tr:hover {
            background-color: #f5f5f5;
        }
        
        .download-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.1em;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
            transition: all 0.3s ease;
            display: block;
            margin: 30px auto;
            font-weight: 600;
        }
        
        .download-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 15px 40px rgba(102, 126, 234, 0.6);
        }
        
        .footer {
            background: #f8f9fa;
            padding: 20px;
            text-align: center;
            color: #666;
            font-size: 0.9em;
        }
        
        @media print {
            body {
                background: white;
                padding: 0;
            }
            
            .download-btn {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="container" id="report">
        <div class="header">
            <h1> Informe Mi Entre R铆os</h1>
            <p>Reporte de Gesti贸n - Octubre 2025</p>
        </div>
        
        <div class="content">
            <div class="stats-grid">
                <div class="stat-card">
                    <h3>Usuarios Registrados</h3>
                    <div class="number">4,382</div>
                    <div class="label">Total al 25/10/2025</div>
                </div>
                
                <div class="stat-card">
                    <h3>Crecimiento</h3>
                    <div class="number">2,872</div>
                    <div class="label">Nuevos desde lanzamiento</div>
                </div>
                
                <div class="stat-card">
                    <h3>Tr谩mites Realizados</h3>
                    <div class="number">2,864</div>
                    <div class="label">Total procesados</div>
                </div>
            </div>
            
            <div class="section">
                <h2>Evoluci贸n de Usuarios</h2>
                <div class="chart-container">
                    <div class="chart-wrapper">
                        <canvas id="usuariosChart"></canvas>
                    </div>
                </div>
            </div>
            
            <div class="section">
                <h2>Distribuci贸n de Tr谩mites por Estado</h2>
                <div class="chart-container">
                    <div class="chart-wrapper">
                        <canvas id="estadosChart"></canvas>
                    </div>
                </div>
            </div>
            
            <div class="section">
                <h2>Tr谩mites por Organismo</h2>
                <div class="chart-container">
                    <div class="chart-wrapper">
                        <canvas id="organismosChart"></canvas>
                    </div>
                </div>
            </div>
            
            <div class="section">
                <h2>Detalle de Tr谩mites por Organismo y Estado</h2>
                <div class="table-container">
                    <table id="tramitesTable">
                        <thead>
                            <tr>
                                <th>Organismo</th>
                                <th>Tr谩mite</th>
                                <th>Estado</th>
                                <th>Cantidad</th>
                            </tr>
                        </thead>
                        <tbody id="tableBody">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <div class="footer">
            <p>Gobierno de Entre R铆os - Plataforma Mi Entre R铆os</p>
            <p>Generado el 25 de Octubre de 2025</p>
        </div>
    </div>
    
    <button class="download-btn" onclick="generarPDF()"> Descargar Informe en PDF</button>
    
    <script>
        const tramitesData = [
            {organismo: "Direcci贸n de Telecomunicaciones", tramite: "Solicitud de Estructuras Soporte", estado: "Rechazado", cantidad: 1},
            {organismo: "Registro Civil", tramite: "Solicitud de actas", estado: "Aprobado", cantidad: 803},
            {organismo: "Registro Civil", tramite: "Solicitud de actas", estado: "En B煤squeda", cantidad: 183},
            {organismo: "Registro Civil", tramite: "Solicitud de actas", estado: "En Revisi贸n", cantidad: 28},
            {organismo: "Registro Civil", tramite: "Solicitud de actas", estado: "Pendiente de Firma", cantidad: 1},
            {organismo: "Registro Civil", tramite: "Solicitud de actas", estado: "Rechazado", cantidad: 8},
            {organismo: "Registro Civil", tramite: "Solicitud de actas", estado: "Subsanaci贸n Necesaria", cantidad: 10},
            {organismo: "Secretar铆a de Comunicaci贸n y Prensa", tramite: "Certificaci贸n de Publicidad", estado: "Aprobado", cantidad: 120},
            {organismo: "Secretar铆a de Comunicaci贸n y Prensa", tramite: "Certificaci贸n de Publicidad", estado: "En Revisi贸n", cantidad: 122},
            {organismo: "Secretar铆a de Comunicaci贸n y Prensa", tramite: "Certificaci贸n de Publicidad", estado: "Rechazado", cantidad: 26},
            {organismo: "Secretar铆a de Comunicaci贸n y Prensa", tramite: "Certificaci贸n de Publicidad", estado: "Subsanaci贸n Necesaria", cantidad: 67},
            {organismo: "Secretar铆a de Comunicaci贸n y Prensa", tramite: "Cotizaci贸n", estado: "Aprobado", cantidad: 67},
            {organismo: "Secretar铆a de Comunicaci贸n y Prensa", tramite: "Cotizaci贸n", estado: "En Resoluci贸n", cantidad: 46},
            {organismo: "Secretar铆a de Comunicaci贸n y Prensa", tramite: "Cotizaci贸n", estado: "En Revisi贸n", cantidad: 172},
            {organismo: "Secretar铆a de Comunicaci贸n y Prensa", tramite: "Cotizaci贸n", estado: "Rechazado", cantidad: 23},
            {organismo: "Secretar铆a de Comunicaci贸n y Prensa", tramite: "Cotizaci贸n", estado: "Subsanaci贸n Necesaria", cantidad: 1},
            {organismo: "Secretar铆a de Comunicaci贸n y Prensa", tramite: "Preinscripci贸n de proveedores", estado: "En Resoluci贸n", cantidad: 22},
            {organismo: "Secretar铆a de Comunicaci贸n y Prensa", tramite: "Preinscripci贸n de proveedores", estado: "En Revisi贸n", cantidad: 3},
            {organismo: "Secretar铆a de Comunicaci贸n y Prensa", tramite: "Preinscripci贸n de proveedores", estado: "Inscrito", cantidad: 309},
            {organismo: "Secretar铆a de Comunicaci贸n y Prensa", tramite: "Preinscripci贸n de proveedores", estado: "Rechazado", cantidad: 3},
            {organismo: "Secretar铆a de Comunicaci贸n y Prensa", tramite: "Preinscripci贸n de proveedores", estado: "Subsanaci贸n Necesaria", cantidad: 139},
            {organismo: "Secretar铆a de Deportes", tramite: "Registro Instituciones Deportivas", estado: "Aprobado", cantidad: 46},
            {organismo: "Secretar铆a de Deportes", tramite: "Registro Instituciones Deportivas", estado: "En Resoluci贸n", cantidad: 1},
            {organismo: "Secretar铆a de Deportes", tramite: "Registro Instituciones Deportivas", estado: "Rechazado", cantidad: 6},
            {organismo: "Secretar铆a de Deportes", tramite: "Registro Instituciones Deportivas", estado: "Subsanaci贸n Necesaria", cantidad: 6},
            {organismo: "Secretar铆a de Deportes", tramite: "Aportes Municipios/ONG's", estado: "Aprobado", cantidad: 8},
            {organismo: "Secretar铆a de Deportes", tramite: "Aportes Municipios/ONG's", estado: "Rechazado", cantidad: 2},
            {organismo: "Secretar铆a de Deportes", tramite: "Aportes Municipios/ONG's", estado: "Subsanaci贸n Necesaria", cantidad: 4},
            {organismo: "Secretar铆a de Deportes", tramite: "Aportes Personas Jur铆dicas", estado: "En Resoluci贸n", cantidad: 52},
            {organismo: "Secretar铆a de Deportes", tramite: "Aportes Personas Jur铆dicas", estado: "En Revisi贸n", cantidad: 2},
            {organismo: "Secretar铆a de Deportes", tramite: "Aportes Personas Jur铆dicas", estado: "Rechazado", cantidad: 9},
            {organismo: "Secretar铆a de Deportes", tramite: "Aportes Personas Jur铆dicas", estado: "Subsanaci贸n Necesaria", cantidad: 15},
            {organismo: "Secretar铆a de Deportes", tramite: "Capacitaciones RCP", estado: "Aprobado", cantidad: 18},
            {organismo: "Secretar铆a de Deportes", tramite: "Capacitaciones RCP", estado: "En Revisi贸n", cantidad: 17},
            {organismo: "Secretar铆a de Deportes", tramite: "Capacitaciones RCP", estado: "Rechazado", cantidad: 1},
            {organismo: "Secretar铆a de Deportes", tramite: "Capacitaciones RCP", estado: "Subsanaci贸n Necesaria", cantidad: 5},
            {organismo: "Secretar铆a de Deportes", tramite: "Reducci贸n Tarifa El茅ctrica", estado: "Elevado a Sec. de Energ铆a", cantidad: 7},
            {organismo: "Secretar铆a de Deportes", tramite: "Reducci贸n Tarifa El茅ctrica", estado: "En Revisi贸n", cantidad: 1},
            {organismo: "Secretar铆a de Deportes", tramite: "Reducci贸n Tarifa El茅ctrica", estado: "Rechazado", cantidad: 1},
            {organismo: "Secretar铆a de Deportes", tramite: "Reducci贸n Tarifa El茅ctrica", estado: "Subsanaci贸n Necesaria", cantidad: 1},
            {organismo: "Secretar铆a de Deportes", tramite: "Solicitud de Transporte", estado: "Aprobado", cantidad: 4},
            {organismo: "Secretar铆a de Deportes", tramite: "Solicitud de Transporte", estado: "En Resoluci贸n", cantidad: 1},
            {organismo: "Secretar铆a de Deportes", tramite: "Solicitud de Transporte", estado: "Rechazado", cantidad: 1},
            {organismo: "Secretar铆a de Gobiernos Locales", tramite: "Ventanilla nica", estado: "Recibido", cantidad: 1},
            {organismo: "Secretar铆a de Modernizaci贸n", tramite: "Inscripci贸n Habilidades Digitales", estado: "En Revisi贸n", cantidad: 3},
            {organismo: "Secretar铆a de Modernizaci贸n", tramite: "Inscripci贸n Habilidades Digitales", estado: "Inscripci贸n", cantidad: 452},
            {organismo: "Secretar铆a de Modernizaci贸n", tramite: "Inscripci贸n Habilidades Digitales", estado: "Inscrito", cantidad: 1},
            {organismo: "Secretar铆a de Modernizaci贸n", tramite: "Pedido de Credencial", estado: "Aprobado", cantidad: 3},
            {organismo: "Secretar铆a de Modernizaci贸n", tramite: "Pre Carga", estado: "Aprobado", cantidad: 5},
            {organismo: "Secretar铆a de Modernizaci贸n", tramite: "Pre Carga", estado: "En Revisi贸n", cantidad: 2},
            {organismo: "Secretar铆a de Modernizaci贸n", tramite: "Pre Carga", estado: "Pre-Aprobado", cantidad: 4},
            {organismo: "Secretar铆a de Modernizaci贸n", tramite: "Pre Carga", estado: "Recibido", cantidad: 3},
            {organismo: "Secretar铆a de Modernizaci贸n", tramite: "Pre Carga", estado: "Subsanaci贸n Necesaria", cantidad: 1},
            {organismo: "Secretar铆a de Modernizaci贸n", tramite: "Despapelizaci贸n/Expurgo", estado: "Aprobado", cantidad: 10},
            {organismo: "Secretar铆a de Modernizaci贸n", tramite: "Despapelizaci贸n/Expurgo", estado: "Rechazado", cantidad: 3},
            {organismo: "Sidecreer", tramite: "Solicitud tarjeta Sidecreer", estado: "Pre-Aprobado", cantidad: 11},
            {organismo: "Sidecreer", tramite: "Solicitud tarjeta Sidecreer", estado: "Rechazado", cantidad: 1},
            {organismo: "Sidecreer", tramite: "Solicitud tarjeta Sidecreer", estado: "Subsanaci贸n Necesaria", cantidad: 2}
        ];

        // Poblar tabla
        const tableBody = document.getElementById('tableBody');
        tramitesData.forEach(item => {
            const row = tableBody.insertRow();
            row.innerHTML = `
                <td>${item.organismo}</td>
                <td>${item.tramite}</td>
                <td>${item.estado}</td>
                <td><strong>${item.cantidad}</strong></td>
            `;
        });

        // Gr谩fico de evoluci贸n de usuarios
        const ctxUsuarios = document.getElementById('usuariosChart').getContext('2d');
        new Chart(ctxUsuarios, {
            type: 'line',
            data: {
                labels: ['Lanzamiento', 'Actual (25/10/2025)'],
                datasets: [{
                    label: 'Usuarios Registrados',
                    data: [1510, 4382],
                    backgroundColor: 'rgba(102, 126, 234, 0.2)',
                    borderColor: 'rgba(102, 126, 234, 1)',
                    borderWidth: 3,
                    fill: true,
                    tension: 0.4,
                    pointRadius: 8,
                    pointHoverRadius: 10
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: true,
                        position: 'top',
                        labels: {
                            font: {
                                size: 14,
                                weight: 'bold'
                            }
                        }
                    },
                    title: {
                        display: true,
                        text: 'Crecimiento: +2,872 usuarios (+190%)',
                        font: {
                            size: 16,
                            weight: 'bold'
                        }
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            font: {
                                size: 12
                            }
                        }
                    },
                    x: {
                        ticks: {
                            font: {
                                size: 12
                            }
                        }
                    }
                }
            }
        });

        // Agrupar por estado
        const estadosMap = {};
        tramitesData.forEach(item => {
            if (!estadosMap[item.estado]) {
                estadosMap[item.estado] = 0;
            }
            estadosMap[item.estado] += item.cantidad;
        });

        const ctxEstados = document.getElementById('estadosChart').getContext('2d');
        new Chart(ctxEstados, {
            type: 'doughnut',
            data: {
                labels: Object.keys(estadosMap),
                datasets: [{
                    data: Object.values(estadosMap),
                    backgroundColor: [
                        '#667eea', '#764ba2', '#f093fb', '#4facfe',
                        '#43e97b', '#fa709a', '#fee140', '#30cfd0',
                        '#a8edea', '#fed6e3', '#c471ed', '#12c2e9'
                    ]
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'right',
                        labels: {
                            font: {
                                size: 12
                            }
                        }
                    }
                }
            }
        });

        // Agrupar por organismo
        const organismosMap = {};
        tramitesData.forEach(item => {
            if (!organismosMap[item.organismo]) {
                organismosMap[item.organismo] = 0;
            }
            organismosMap[item.organismo] += item.cantidad;
        });

        const ctxOrganismos = document.getElementById('organismosChart').getContext('2d');
        new Chart(ctxOrganismos, {
            type: 'bar',
            data: {
                labels: Object.keys(organismosMap).map(o => o.length > 30 ? o.substring(0, 27) + '...' : o),
                datasets: [{
                    label: 'Cantidad de Tr谩mites',
                    data: Object.values(organismosMap),
                    backgroundColor: 'rgba(102, 126, 234, 0.8)',
                    borderColor: 'rgba(102, 126, 234, 1)',
                    borderWidth: 2
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: false
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            font: {
                                size: 12
                            }
                        }
                    },
                    x: {
                        ticks: {
                            font: {
                                size: 10
                            },
                            maxRotation: 45,
                            minRotation: 45
                        }
                    }
                }
            }
        });

        async function generarPDF() {
            const { jsPDF } = window.jspdf;
            const pdf = new jsPDF('p', 'mm', 'a4');
            const elemento = document.getElementById('report');
            
            // Ocultar el bot贸n temporalmente
            const btn = document.querySelector('.download-btn');
            btn.style.display = 'none';
            
            try {
                const canvas = await html2canvas(elemento, {
                    scale: 2,
                    useCORS: true,
                    logging: false,
                    backgroundColor: '#ffffff'
                });
                
                const imgData = canvas.toDataURL('image/png');
                const imgWidth = 210;
                const pageHeight = 297;
                const imgHeight = (canvas.height * imgWidth) / canvas.width;
                let heightLeft = imgHeight;
                let position = 0;

                pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                heightLeft -= pageHeight;

                while (heightLeft >= 0) {
                    position = heightLeft - imgHeight;
                    pdf.addPage();
                    pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                    heightLeft -= pageHeight;
                }

                pdf.save('Informe_Mi_Entre_Rios_Octubre_2025.pdf');
            } catch (error) {
                console.error('Error al generar PDF:', error);
                alert('Hubo un error al generar el PDF. Por favor, intente nuevamente.');
            } finally {
                btn.style.display = 'block';
            }
        }
    </script>
</body>
</html>